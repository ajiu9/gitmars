#!/usr/bin/env node
"use strict";const{program:e}=require("commander"),r=require("shelljs"),{options:s,args:i}=require("./conf/revert"),{error:t,warning:o,queue:n,isGitProject:a}=require("./js/index"),{createArgs:c}=require("./js/tools");a()||(r.echo(t("当前目录不是git项目目录")),r.exit(1)),e.name("gitm revert").usage("[commitid] [-n --number [number]] [-m --mode [mode]]").description("撤销一次提交记录"),i.length>0&&e.arguments(c(i)),s.forEach((r=>{e.option(r.flags,r.description,r.defaultValue)})),e.action(((e,s)=>{const i=[];let t="HEAD",a="";if(s.mode&&(a=" -m "+Math.abs(Number(s.mode))),s.number){const e=Math.abs(Number(s.number));e>1&&(t+="~"+(e-1)),i.push({cmd:`git revert ${t}${a}`,config:{slient:!1,again:!0,success:"撤销成功",fail:"出错了，请根据提示处理"}})}else e?i.push({cmd:`git revert ${e}${a}`,config:{slient:!1,again:!0,success:"撤销成功",fail:"出错了，请根据提示处理"}}):(r.echo(o("指令不合法")),r.exit(1));n(i)})),e.parse(process.argv);
