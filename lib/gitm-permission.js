#!/usr/bin/env node
"use strict";var program=require("commander");var sh=require("shelljs");var _require=require("./js/index"),error=_require.error,getCurrent=_require.getCurrent;var config=require("./js/getConfig")();program.name("gitm permission").usage("[message]").arguments("[message]").description("校验提交权限").option("--no-verify","是否需要跳过校验权限",false).option("--dev","是否限制dev提交",false).option("--release","是否限制release提交",false).action(function(message,opt){console.log("gitm permission is running");var current=getCurrent();var allow=[config.master],msg=sh.exec("git show",{silent:true}).stdout,index;if(opt.dev)allow.push(config.develop);if(opt.release)allow.push(config.release);index=allow.indexOf(current);if(index>-1&&!opt.noVerify&&msg&&msg.indexOf("Merge:")===-1&&msg.indexOf("Merge branch")===-1){sh.echo(error("".concat(allow[index],"分支不允许直接提交")));sh.exit(1)}else{sh.exit(0)}});program.parse(process.argv);