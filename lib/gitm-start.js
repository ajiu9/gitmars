#!/usr/bin/env node
"use strict";require("core-js/modules/es.symbol.js");require("core-js/modules/es.symbol.description.js");require("core-js/modules/es.function.name.js");require("core-js/modules/web.dom-collections.for-each.js");require("core-js/modules/es.regexp.flags.js");require("core-js/modules/es.array.includes.js");require("core-js/modules/es.array.concat.js");var program=require("commander");var sh=require("shelljs");var _require=require("./conf/start"),options=_require.options,args=_require.args;var _require2=require("./js/index"),error=_require2.error,success=_require2.success,queue=_require2.queue,getStatus=_require2.getStatus,createArgs=_require2.createArgs;var config=require("./js/getConfig")();program.name("gitm start").usage("<type> <name>").description("创建bugfix任务分支、创建feature功能开发分支、support框架支持分支");if(args.length>0)program.arguments(createArgs(args));options.forEach(function(o){program.option(o.flags,o.description,o.defaultValue)});program.action(function(type,name){var opts=["bugfix","feature","support"];var status=getStatus();if(!status)sh.exit(1);if(opts.includes(type)){var base=type==="bugfix"?config.bugfix:type==="support"?config.master:config.release,cmd=["git fetch","git checkout ".concat(base),"git pull","git checkout -b ".concat(type,"/").concat(name," ").concat(base)];queue(cmd).then(function(data){if(data[3].code===0){sh.echo("".concat(name,"分支创建成功，该分支基于").concat(base,"创建，您当前已经切换到").concat(type,"/").concat(name,"\n如果需要提测，请执行").concat(success("gitm combine "+type+" "+name),"\n开发完成后，记得执行: ").concat(success("gitm end "+type+" "+name)))}})}else{sh.echo(error("type只允许输入："+JSON.stringify(opts)));sh.exit(1)}});program.parse(process.argv);