"use strict";require("core-js/modules/es.array.filter");require("core-js/modules/es.array.for-each");require("core-js/modules/es.array.join");require("core-js/modules/es.array.map");require("core-js/modules/web.dom-collections.for-each");var fs=require("fs");var path=require("path");var _require=require("./global"),gitHookDir=_require.gitHookDir,hookList=_require.hookList;var getHookComment=require("./hook/getHookComment");var getHookType=require("./hook/getHookType");var getHookShell=require("./hook/getHookShell");var getLocalShell=require("./hook/getLocalShell");function createHooks(){var dir=arguments.length>0&&arguments[0]!==undefined?arguments[0]:gitHookDir;var writeHook=function writeHook(filename,shell){fs.writeFileSync(filename,shell,"utf-8");fs.chmodSync(filename,493)};var hooks=hookList.map(function(hookName){return path.join(dir,hookName)});hooks.forEach(function(filename,i){var hookShell="#!/bin/sh\n# gitmars\n\n".concat(getHookComment(),'\n\n. "$(dirname "$0")/gitmars.sh"');var name=path.basename(filename);if(fs.existsSync(filename)){var hook=fs.readFileSync(filename,"utf-8");if(getHookType.isGhooks(hook)){console.info("合并已存在的ghooks钩子: ".concat(name));return writeHook(filename,hookShell)}if(getHookType.isPreCommit(hook)){console.info("合并已存在的pre-commit钩子: ".concat(name));return writeHook(filename,hookShell)}if(getHookType.isGitmars(hook)||getHookType.isHusky(hook)||getHookType.isYorkie(hook)){return writeHook(filename,hookShell)}console.info("跳过已存在的用户git钩子: ".concat(name));return}writeHook(filename,hookShell)})}function removeHooks(){var dir=arguments.length>0&&arguments[0]!==undefined?arguments[0]:gitHookDir;var hooks=hookList.map(function(hookName){return path.join(dir,hookName)});hooks.filter(function(filename){if(fs.existsSync(filename)){var hook=fs.readFileSync(filename,"utf-8");return getHookType.isGitmars(hook)}return false}).forEach(function(filename){fs.unlinkSync(filename)})}function createHookShell(){var dir=arguments.length>0&&arguments[0]!==undefined?arguments[0]:gitHookDir;fs.writeFileSync(path.join(dir,"gitmars.sh"),getHookShell(),"utf-8")}function removeHookShell(){var dir=arguments.length>0&&arguments[0]!==undefined?arguments[0]:gitHookDir;var filename=path.join(dir,"gitmars.sh");if(fs.existsSync(filename))fs.unlinkSync(filename)}function createLocalShell(){var dir=arguments.length>0&&arguments[0]!==undefined?arguments[0]:gitHookDir;var pmName=arguments.length>1?arguments[1]:undefined;var relativeUserPkgDir=arguments.length>2?arguments[2]:undefined;fs.writeFileSync(path.join(dir,"gitmars.local.sh"),getLocalShell(pmName,relativeUserPkgDir),"utf-8")}function removeLocalShell(){var dir=arguments.length>0&&arguments[0]!==undefined?arguments[0]:gitHookDir;var filename=path.join(dir,"gitmars.local.sh");if(fs.existsSync(filename))fs.unlinkSync(filename)}module.exports={createHooks:createHooks,removeHooks:removeHooks,createHookShell:createHookShell,removeHookShell:removeHookShell,createLocalShell:createLocalShell,removeLocalShell:removeLocalShell};