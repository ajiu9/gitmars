"use strict";require("core-js/modules/es.array.concat.js");require("core-js/modules/es.regexp.exec.js");var sh=require("shelljs");var _require=require("./index"),error=_require.error,getGitUser=_require.getGitUser;var config=require("./getConfig")();exports.getUserToken=function(){if(!config.api){sh.echo(error("请配置用于请求权限的api接口地址，接收参数形式：url?name=git_user_name，返回data=token"));process.exit(1)}var user=getGitUser();if(!user){sh.echo(error("请设置本地git用户名"));process.exit(1)}var fetchData=sh.exec("curl -s ".concat(config.api,"?name=").concat(user),{silent:true}).stdout,userInfo;try{fetchData=JSON.parse(fetchData);userInfo=fetchData.data&&fetchData.data.list.length>0?fetchData.data.list[0]:null}catch(err){userInfo=null}if(!userInfo){sh.echo(error("没有找到用户，请联系管理员"));process.exit(1)}else if(!userInfo.token){sh.echo(error("请设置access_token"));process.exit(1)}return userInfo};