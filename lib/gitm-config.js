#!/usr/bin/env node
"use strict";function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}var program=require("commander");var sh=require("shelljs");var gitRevParse=require("./js/gitRevParse");var _require=require("./js/index"),error=_require.error,success=_require.success,writeFile=_require.writeFile;var _require2=require("./js/global"),defaults=_require2.defaults;var config=require("./js/getConfig")();program.name("gitm config").usage("<option> [value]").command("set <option> [value]").description("设置gitmars的配置项").action(function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(option,value){var filepath,_gitRevParse,root;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:filepath=config.filepath;if(!filepath){_gitRevParse=gitRevParse(),root=_gitRevParse.root;filepath=root+"/.gitmarsrc"}if(!value){_context.next=17;break}if(!Object.keys(defaults).includes(option)){_context.next=13;break}config[option]=value;delete config.filepath;delete config.skipCI;_context.next=9;return writeFile(filepath,JSON.stringify(config,null,4));case 9:sh.echo(success("保存成功"));sh.exit(0);_context.next=15;break;case 13:sh.echo(error("不支持"+option+"这个配置项"));sh.exit(1);case 15:_context.next=19;break;case 17:sh.echo("请输入要配置的项");sh.exit(1);case 19:case"end":return _context.stop()}}},_callee)}));return function(_x,_x2){return _ref.apply(this,arguments)}}());program.name("gitm config").usage("list [option]").command("list [option]").description("查询单个或全部gitmars的配置项").action(function(option){if(option){sh.echo(success(config[option]))}else{sh.echo(success(config))}sh.exit(0)});program.parse(process.argv);